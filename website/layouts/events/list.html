{{ define "main" }}

{{/* ===== SCHEDULE VIEW ===== */}}
<section aria-label="Upcoming cycling events" class="-mt-2">
  {{ $prevDate := "" }}
  {{ range sort .Pages "Params.sort_key" "asc" }}
    {{ $startRaw := or .Params.start.dateTime .Params.start.date }}
    {{ $curDate := (time.AsTime $startRaw | time.Format "2006-01-02") }}

    {{/* Date header for new date groups */}}
    {{ if ne $curDate $prevDate }}
      <h3 class="flex items-center pt-3 pb-2" role="heading" aria-level="3">
        <span class="text-sm font-extrabold text-stone-700 tracking-wide" data-date="{{ $curDate }}">{{ time.AsTime $startRaw | time.Format "Monday, Jan 2" }}</span>
      </h3>
    {{ end }}
    {{ $prevDate = $curDate }}

    {{/* Schedule event row */}}
    <article class="{{ .Params.source_id }}">
      <a href="{{ .RelPermalink }}" class="flex items-stretch gap-3 no-underline text-inherit py-1 visited:text-inherit link-btn" aria-label="{{ .Params.summary }}">
        <div class="w-15 min-w-15 text-xs font-mono text-stone-700 pt-2 text-right shrink-0">
          {{ if .Params.start.dateTime }}
            {{ time.AsTime .Params.start.dateTime | time.Format "3:04 PM" }}
          {{ else }}
            All day
          {{ end }}
        </div>
        <div class="schedule-card flex flex-1 min-w-0 rounded-lg overflow-hidden relative">
          <div class="schedule-card__accent-border w-1.5 min-w-1.5 {{ with .Params.first_known_tag }}bg-tag-{{ . }}{{ else }}bg-stone-600{{ end }}"></div>
          <div class="flex flex-col gap-0.5 py-1 px-3 min-w-0 ">
            <span class="font-semibold text-[0.95rem] whitespace-nowrap overflow-hidden text-ellipsis">{{ .Params.summary }}</span>
            {{ with .Params.location }}
              <span class="text-xs text-stone-600 whitespace-nowrap overflow-hidden text-ellipsis">
                {{ index (split . ",") 0 }}
                
              </span>
              
            {{ end }}
            
            <span class="-mt-1">
              {{ range .Params.known_tags }}{{ partial "tag.html" (dict "tag" . "small" true) }}{{ end }}
              {{ if .Params.recurrence_future_count }}
                {{ partial "tag.html" (dict "tag" (slice "recurring" "Recurring") "small" true) }}
              {{ end }}
            </span>
          </div>          
        </div>
      </a>
    </article>
  {{ end }}
</section>

{{ end }}
